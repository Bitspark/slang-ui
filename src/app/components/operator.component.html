<div>
  <h2>Operator "{{operatorName}}"</h2>
</div>

<div>
  <button (click)="save()">Save</button>
</div>

<div>
  <div>
    YAML view
  </div>
  <textarea cols="150" rows="15" title="YAML representation" [ngModel]="yamlRepr" (ngModelChange)="updateYaml($event)"
            (blur)="storeYaml()">
</textarea>
</div>

<div>
  <div>
    Visual view
  </div>
  <div style="height: 700px">
    <div style="width: 800px; height: 600px; overflow: scroll; display: inline-block">
      <svg [attr.width]="1600*scale" [attr.height]="1200*scale" style="border: 1px dotted black;"
           viewBox="0 0 1600 1200"
           xmlns:svg="http://www.w3.org/2000/svg"
           (mousedown)="startDrag($event)"
           (mouseup)="stopDrag($event)"
           (mousemove)="drag($event)">

        <svg:g *ngIf="operator" [attr.transform]="transform(operator)">
          <svg:rect x="0" y="0" [attr.width]="operator.getWidth()" [attr.height]="operator.getHeight()"
                    fill="transparent"
                    [attr.stroke]="operator === visualSelectedInst ? 'red' : 'orange'" stroke-dasharray="3 3" stroke-width="3"
                    (mousedown)="selectVisualInstance(operator)"></svg:rect>
          <svg:g *ngFor="let dlg of operator.getDelegates()" [attr.transform]="transform(dlg)">
            <svg:g [attr.transform]="transform(dlg.getIn())" app-port [port]="dlg.getIn()"></svg:g>
            <svg:g [attr.transform]="transform(dlg.getOut())" app-port [port]="dlg.getOut()"></svg:g>
          </svg:g>
          <svg:g [attr.transform]="transform(operator.getMainIn())" app-port [port]="operator.getMainIn()"></svg:g>
          <svg:g [attr.transform]="transform(operator.getMainOut())" app-port [port]="operator.getMainOut()"></svg:g>

          <svg:g *ngFor="let ins of visualInstances()" [attr.transform]="transform(ins)">
            <svg:rect x="0" y="0" [attr.width]="ins.getWidth()" [attr.height]="ins.getHeight()" fill="orange"
                      [attr.stroke]="ins === visualSelectedInst ? 'red' : ''" stroke-dasharray="3 3" stroke-width="2"
                      (mousedown)="selectVisualInstance(ins)"></svg:rect>
            <svg:text text-anchor="middle" x="65" y="35" fill="white" font-family="Arial" font-size="16"
                      style="pointer-events: none">{{ins.getName()}}
            </svg:text>
            <svg:g *ngFor="let dlg of ins.getDelegates()" [attr.transform]="transform(dlg)">
              <svg:g [attr.transform]="transform(dlg.getIn())" app-port [port]="dlg.getIn()"></svg:g>
              <svg:g [attr.transform]="transform(dlg.getOut())" app-port [port]="dlg.getOut()"></svg:g>
            </svg:g>
            <svg:g [attr.transform]="transform(ins.getMainIn())" app-port [port]="ins.getMainIn()"></svg:g>
            <svg:g [attr.transform]="transform(ins.getMainOut())" app-port [port]="ins.getMainOut()"></svg:g>
          </svg:g>
        </svg:g>
        <svg:line *ngFor="let c of visualConnections()"
                  stroke="green"
                  stroke-width="2px"
                  [attr.x1]="c.getSource().getPortPosX()"
                  [attr.y1]="c.getSource().getPortPosY()"
                  [attr.x2]="c.getDestination().getPortPosX()"
                  [attr.y2]="c.getDestination().getPortPosY()"></svg:line>
      </svg>
    </div>
    <div style="border: 1px dotted black; display: inline-block; height: 600px; overflow: scroll; margin-left: 20px">
      <div>
        <h2>Elementary operators</h2>
        <ul>
          <li *ngFor="let op of operators.getElementaries()">{{ op.getName() }}
            <button (click)="addInstance(op)">+</button>
          </li>
        </ul>
      </div>
    </div>
  </div>
</div>

<div>
  Status: {{status}}
</div>
